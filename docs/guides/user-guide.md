# 用户使用指南

本指南将帮助您快速上手音频质量分析器，了解如何使用各种功能来分析音频文件的质量。

## 目录

1. [快速开始](#快速开始)
2. [界面介绍](#界面介绍)
3. [分析流程](#分析流程)
4. [结果解读](#结果解读)
5. [高级功能](#高级功能)
6. [常见问题](#常见问题)

## 快速开始

### 第一次使用

1. **下载并安装**
   - 从官方网站下载适合您操作系统的版本
   - 解压到任意目录
   - 确保有足够的磁盘空间（建议至少 100MB）

2. **准备音频文件**
   - 将要分析的音频文件放在一个文件夹中
   - 支持嵌套文件夹，程序会递归扫描所有子目录
   - 确保文件格式受支持（WAV、MP3、FLAC 等）

3. **运行程序**
   ```bash
   # macOS/Linux
   ./audio-analyzer
   
   # Windows
   audio-analyzer.exe
   ```

### 基本操作流程

1. 启动程序后，会看到欢迎信息
2. 输入音频文件夹的完整路径
3. 程序开始扫描和分析文件
4. 等待分析完成
5. 查看生成的报告文件

## 界面介绍

### 命令行界面

程序采用命令行界面，主要包含以下部分：

```
欢迎使用音频质量分析器 v4.0 (重构优化版)
开始时间: 2024-01-15 14:30:25

正在初始化依赖项...
请输入要递归处理的音乐顶层文件夹路径: /Users/username/Music
正在扫描文件夹: /Users/username/Music
扫描完成，找到 150 个音频文件待处理。开始并行分析...

[1/150] 正在处理: song1.wav
[2/150] 正在处理: song2.mp3
...
```

### 进度显示

- **文件计数**: 显示当前处理进度 `[当前/总数]`
- **文件名**: 显示正在处理的文件名
- **时间信息**: 显示开始时间和预计完成时间
- **错误提示**: 如果某个文件处理失败，会显示详细错误信息

## 分析流程

### 1. 文件扫描阶段

程序首先递归扫描指定目录，查找所有支持的音频文件：

- 支持的格式：WAV, MP3, FLAC, AAC, OGG, OPUS, WMA, AIFF, ALAC, M4A
- 忽略隐藏文件和系统文件
- 显示找到的文件总数

### 2. 并行分析阶段

对每个音频文件执行以下分析：

#### 基础信息提取
- 文件大小
- 文件路径
- 处理时间

#### 动态范围分析
- **LRA (Loudness Range)**: 使用 EBU R128 标准测量
- 评估音频的动态范围是否合适
- 检测过度压缩问题

#### 频谱分析
- **16kHz 以上频段**: 检测高频内容完整性
- **18kHz 以上频段**: 识别伪造和升频音频
- **20kHz 以上频段**: 评估超高频内容

#### 峰值分析
- **峰值电平**: 检测数字削波
- **RMS 电平**: 评估平均响度
- **过载检测**: 识别音频过载问题

### 3. 报告生成阶段

分析完成后生成两个文件：

1. **analysis_data.json**: 原始分析数据（JSON 格式）
2. **audio_quality_report.csv**: 格式化报告（CSV 格式）

## 结果解读

### 质量评分系统

程序使用 0-100 分的评分系统：

- **90-100 分**: 🟢 优秀 - 专业级音质，无明显问题
- **80-89 分**: 🟢 良好 - 高质量音频，轻微问题
- **70-79 分**: 🟡 一般 - 可接受的质量，有一些问题
- **60-69 分**: 🟡 较差 - 质量问题较多，建议重新处理
- **0-59 分**: 🔴 很差 - 严重质量问题，不建议使用

### 状态分类

#### 🟢 质量良好
- 所有指标都在正常范围内
- 没有发现明显的技术问题
- 可以安全使用

#### 🟡 疑似处理
- 频谱在某些频段能量较低
- 可能经过了某种音频处理
- 建议进一步检查

#### 🔴 可疑 (伪造)
- 频谱存在硬性截止
- 高度疑似伪造或升频
- 不建议使用

#### 🔴 已削波
- 存在数字削波现象
- 音频可能过载
- 需要重新处理

#### 🔴 严重压缩
- 动态范围极低
- 过度压缩导致音质损失
- 建议使用原始版本

#### 🟡 低动态
- 动态范围偏低
- 可能过度压缩
- 可以使用但不是最佳状态

#### 🟡 数据不完整
- 某些关键数据缺失
- 分析可能不准确
- 建议重新分析

### CSV 报告字段说明

| 字段名 | 含义 | 正常范围 | 说明 |
|--------|------|----------|------|
| 质量分 | 综合质量评分 | 80-100 | 越高越好 |
| 状态 | 质量状态 | 质量良好 | 见上述分类 |
| filePath | 文件路径 | - | 完整文件路径 |
| 备注 | 详细说明 | - | 具体问题描述 |
| lra | 响度范围 | 8-12 LU | 动态范围指标 |
| peakAmplitudeDb | 峰值电平 | < -6 dB | 削波检测 |
| rmsDbAbove16k | 16kHz以上RMS | > -70 dB | 高频完整性 |
| rmsDbAbove18k | 18kHz以上RMS | > -80 dB | 伪造检测 |
| rmsDbAbove20k | 20kHz以上RMS | > -90 dB | 超高频内容 |

## 高级功能

### 环境变量配置

可以通过设置环境变量来自定义程序行为：

```bash
# 启用详细输出模式
export AUDIO_ANALYZER_VERBOSE=true

# 设置并行线程数
export AUDIO_ANALYZER_THREADS=8

# 运行程序
./audio-analyzer
```

### 批处理模式

对于大量文件的处理，建议：

1. **分批处理**: 将文件分成较小的批次
2. **监控资源**: 注意 CPU 和内存使用情况
3. **备份数据**: 处理前备份重要文件
4. **验证结果**: 随机抽查分析结果的准确性

### 结果筛选

可以根据需要筛选分析结果：

```bash
# 只查看高质量文件（评分 > 80）
grep -E "^[89][0-9]|^100" audio_quality_report.csv

# 查看有问题的文件
grep -v "质量良好" audio_quality_report.csv

# 按评分排序
sort -t',' -k1 -nr audio_quality_report.csv
```

## 常见问题

### Q: 程序运行很慢怎么办？

A: 可以尝试以下方法：
- 设置合适的线程数：`export AUDIO_ANALYZER_THREADS=4`
- 确保有足够的内存
- 关闭其他占用 CPU 的程序
- 分批处理大量文件

### Q: 某些文件分析失败怎么办？

A: 常见原因和解决方法：
- **文件损坏**: 尝试用其他播放器打开文件
- **格式不支持**: 转换为支持的格式
- **权限问题**: 确保有读取文件的权限
- **路径问题**: 避免使用特殊字符的路径

### Q: 如何理解分析结果？

A: 建议：
- 先阅读本指南的"结果解读"部分
- 对比已知质量的音频文件结果
- 关注"状态"和"备注"字段的信息
- 必要时咨询音频工程专家

### Q: 程序占用内存过多怎么办？

A: 可以：
- 减少并行线程数
- 分批处理文件
- 关闭详细输出模式
- 重启程序释放内存

### Q: 如何验证分析结果的准确性？

A: 建议：
- 使用已知质量的测试文件
- 对比其他专业音频分析工具的结果
- 人工听音验证关键问题
- 查看详细的技术指标

如果遇到其他问题，请查看 [故障排除指南](troubleshooting.md) 或联系技术支持。
